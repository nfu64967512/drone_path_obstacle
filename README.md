# 無人機群飛網格航線規劃工具 (Drone Swarm Grid Path Planner)

這是一個專為無人機群飛任務設計的高級路徑規劃軟體。本系統具備現代化圖形介面，能夠自動將不規則的多邊形區域分割為多個子區域，並生成優化的網格掃描路徑。

系統整合了**智能避撞演算法**與**動態障礙物管理**，支援網格線智能分段與繞行，並針對群飛任務提供自動化的起飛延遲 (LOITER) 與返航高度分層 (RTL Altitude Separation) 機制，確保多機作業的安全性。

## 🚀 主要功能

### 1. 區域分割與群飛規劃
* **多邊形區域劃分**：支援任意多邊形邊界的定義，並可將其分割為 1-4 個子區域供多台無人機同時作業。
* **子區域間隔控制**：可設定子區域間的安全間隔 (Gap)，避免相鄰無人機在邊界處發生衝突。
* **互補掃描策略**：支援「減少重疊」模式，相鄰區域的掃描方向自動交錯。

### 2. 智能障礙物避讓 (Smart Obstacle Avoidance)
* **動態障礙物管理**：可在地圖上動態新增、調整或刪除圓形障礙物。
* **網格線智能分段**：基於切線路徑演算法 (Tangent Path Algorithm)，當掃描線穿過障礙物時，自動計算進入點與離開點，生成沿著安全邊界的繞行路徑。
* **最大化覆蓋率**：不同於簡單的區域挖空，系統會保留障礙物前後的掃描路徑，確保偵察覆蓋率最大化。

### 3. 飛行安全機制
* **群飛協同避撞**：
    * **自動 LOITER 計算**：依據前機的飛行軌跡，自動計算後機所需的起飛等待時間，確保 5 公尺以上的安全間距。
    * **RTL 高度分層**：不同子區域的無人機在返航 (Return to Launch) 時會被分配不同的飛行高度，防止返航點上空擁塞。
* **參數驗證**：內建完整的飛行動力學參數檢查，包含最大加速度、轉向速度與風阻係數考量。

### 4. 現代化使用者介面
* **即時預覽**：調整參數時可即時預覽路徑、障礙物繞行結果與子區域劃分。
* **直觀操作**：採用現代化 Slider 元件與圖層管理，支援 Google 衛星地圖與 OpenStreetMap 切換。

### 5. 輸出格式
* **QGC 兼容**：生成的航點檔案 (.waypoints) 完全兼容 QGroundControl 與 Mission Planner。
* **任務簡報**：匯出時自動生成 `mission_briefing.txt`，包含各機的等待時間、高度設定與任務參數摘要。

## 📂 檔案結構

* `main.py`: 程式進入點。
* `main_app.py`: 主應用程式邏輯與 GUI 整合核心。
* `ui_components.py`: 定義現代化 UI 組件 (Slider, Style Manager)。
* `map_manager.py`: 負責地圖伺服器的載入與圖層管理。
* `obstacle_manager.py`: **核心演算法**，負責障礙物偵測、線段與圓的交點計算及繞行路徑生成。
* `obstacle_ui_extension.py`: 障礙物管理的 UI 擴充模組。
* `waypoint_generator.py`: 負責生成網格掃描路徑、插入 LOITER 指令與 RTL 邏輯。
* `collision_avoidance.py`: 計算群飛間距與安全延遲時間。
* `region_divider.py`: 負責多邊形區域的幾何分割與雙線性插值運算。
* `config.py`: 系統常數與飛行動力學參數配置。
* `logger_utils.py`: (需自行實作或提供) 日誌記錄工具。

## 🛠️ 安裝與執行

### 系統需求
* Python 3.8 或以上版本
* Windows / macOS / Linux (建議具備 GUI 環境)

### 安裝步驟

1.  複製專案儲存庫：
    ```bash
    git clone <repository_url>
    cd <repository_directory>
    ```

2.  安裝相依套件：
    ```bash
    pip install -r requirements.txt
    ```

3.  執行程式：
    ```bash
    python main.py
    ```

## 📖 使用指南

1.  **設定邊界**：
    * 將模式設為 `Add`，在地圖上點擊 3-10 個點以圍繞出任務區域。
    * 點擊 `完成邊界`。

2.  **設定障礙物 (可選)**：
    * 點擊 `創建障礙物`，在地圖上點選障礙位置。
    * 選中障礙物後，可透過滑桿調整半徑與安全邊距。

3.  **調整飛行參數**：
    * 設定飛行高度、速度、掃描間距與角度。
    * 選擇 `子區分割` 數量 (例如：3台無人機)。

4.  **預覽與匯出**：
    * 點擊 `預覽路徑` 查看規劃結果與避障路徑。
    * 確認無誤後，點擊 `匯出航點`。
    * 系統將生成多個 `.waypoints` 檔案及任務簡報。

## ⚠️ 注意事項

* 本工具生成的路徑基於數學模型，實際飛行前請務必在模擬器 (如 SITL) 中進行驗證。
* 障礙物避讓採用 2D 平面投影算法，請確保飛行高度高於區域內任何未標記的低矮障礙物。

## License

[License Type, e.g., MIT License]
